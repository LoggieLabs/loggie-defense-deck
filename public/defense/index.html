<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>Loggie — Defense Pitch Deck</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body {
    width: 100%;
    height: 100vh;
    height: 100dvh;
    background: #0B1120;
    font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    overflow: hidden;
    user-select: none;
    -webkit-user-select: none;
  }

  /* Slide container */
  .deck {
    position: relative;
    width: 100%;
    height: 100%;
    touch-action: pan-y;
    overscroll-behavior: none;
  }

  .slide {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
  }

  .slide.nearby {
    display: flex;
  }

  .slide.active {
    display: flex;
    opacity: 1;
    pointer-events: auto;
  }

  .slide img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  /* Progress bar */
  .progress {
    position: fixed;
    bottom: 0;
    left: 0;
    height: 3px;
    background: #6B9B8A;
    transition: width 0.3s ease;
    z-index: 100;
  }

  /* Slide counter */
  .counter {
    position: fixed;
    bottom: 12px;
    right: 20px;
    color: rgba(255, 255, 255, 0.4);
    font-size: 14px;
    font-weight: 500;
    z-index: 100;
    letter-spacing: 0.5px;
  }

  /* Controls overlay */
  .controls {
    position: fixed;
    bottom: 12px;
    left: 20px;
    display: flex;
    gap: 8px;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  body:hover .controls {
    opacity: 1;
  }

  .controls button {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: rgba(255, 255, 255, 0.6);
    padding: 6px 14px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
  }

  .controls button:hover {
    background: rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.9);
  }

  /* Menu button — hidden on desktop, shown on mobile */
  .menu-btn {
    display: none;
  }

  /* Help overlay */
  .help-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .help-overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }

  .help-content {
    color: rgba(255, 255, 255, 0.8);
    font-size: 16px;
    line-height: 2.2;
    text-align: center;
  }

  .help-content kbd {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 3px 10px;
    border-radius: 4px;
    font-family: 'Cascadia Code', 'Fira Code', monospace;
    font-size: 14px;
    margin: 0 2px;
  }

  .help-content .title {
    font-size: 20px;
    font-weight: 600;
    color: #6B9B8A;
    margin-bottom: 16px;
  }

  /* Click zones for navigation */
  .click-prev, .click-next {
    position: fixed;
    top: 0;
    height: 100%;
    z-index: 50;
    cursor: pointer;
  }

  .click-prev { left: 0; width: 25%; }
  .click-next { right: 0; width: 75%; }

  /* Fullscreen adjustments */
  :fullscreen .slide img,
  :-webkit-full-screen .slide img {
    max-width: 100vw;
    max-height: 100vh;
  }

  /* Top-right controls */
  .topright {
    position: fixed;
    top: 14px;
    right: 18px;
    display: flex;
    gap: 14px;
    align-items: center;
    z-index: 100;
    padding-top: env(safe-area-inset-top, 0px);
  }

  .dl {
    font: 12px/1.2 Inter, system-ui, -apple-system, 'Segoe UI', Helvetica, Arial, sans-serif;
    color: rgba(176, 184, 200, 0.75);
    text-decoration: none;
    letter-spacing: 0.6px;
  }

  .dl:hover {
    color: rgba(255, 255, 255, 0.85);
    text-decoration: underline;
  }

  .dl.btn {
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
  }

  .sha-status {
    font: 12px/1.2 Inter, system-ui, -apple-system, 'Segoe UI', Helvetica, Arial, sans-serif;
    color: rgba(176, 184, 200, 0.65);
    letter-spacing: 0.3px;
    min-width: 92px;
    text-align: left;
    transition: opacity 0.4s ease;
  }

  .sha-status.ok { color: rgba(107, 155, 138, 0.95); }
  .sha-status.bad { color: rgba(200, 110, 110, 0.95); }
  .sha-status.warn { color: rgba(176, 184, 200, 0.65); }

  /* Docs overlay */
  .docs-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .docs-overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }

  .docs-content {
    width: 340px;
    max-width: 90vw;
  }

  .docs-content .title {
    font-size: 20px;
    font-weight: 600;
    color: #6B9B8A;
    margin-bottom: 18px;
    text-align: center;
  }

  .docs-content a {
    display: block;
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    font-size: 15px;
    padding: 10px 14px;
    border-radius: 6px;
    transition: background 0.15s ease;
  }

  .docs-content a:hover {
    background: rgba(255, 255, 255, 0.08);
    color: #fff;
  }

  /* SHA-256 checksum footer */
  .checksum {
    position: fixed;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    font: 9px/1.2 'Cascadia Code', 'Fira Code', Consolas, monospace;
    color: rgba(176, 184, 200, 0.3);
    letter-spacing: 0.4px;
    z-index: 100;
    white-space: nowrap;
  }

  /* ── Mobile bottom-sheet menu ────────────────────────────────── */
  .menu-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 300;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
  }

  .menu-backdrop.open {
    opacity: 1;
    pointer-events: auto;
  }

  .menu-sheet {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1a2035;
    border-radius: 14px 14px 0 0;
    z-index: 301;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    padding: 12px 16px;
    padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .menu-sheet.open {
    transform: translateY(0);
  }

  .menu-sheet .menu-handle {
    width: 36px;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    margin: 0 auto 10px;
  }

  .menu-sheet button,
  .menu-sheet a {
    display: block;
    width: 100%;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.8);
    font: 15px/1.2 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    padding: 14px 16px;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    text-decoration: none;
  }

  .menu-sheet button:active,
  .menu-sheet a:active {
    background: rgba(255, 255, 255, 0.08);
  }

  /* ── Mobile (touch device, coarse pointer) ──────────────────── */
  @media (hover: none) and (pointer: coarse) {
    /* Always show controls on mobile */
    .controls {
      opacity: 1;
      left: 0;
      right: 0;
      bottom: 0;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.4));
    }

    /* Thumb-sized buttons */
    .controls button {
      min-height: 44px;
      min-width: 44px;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 8px;
    }

    /* Hide desktop-only controls; show ⋯ menu button */
    .controls .desktop-only { display: none; }
    .menu-btn { display: inline-flex; align-items: center; justify-content: center; }

    /* 50 / 50 tap zones */
    .click-prev { width: 50%; }
    .click-next { width: 50%; }

    /* Hide desktop chrome on mobile */
    .topright { display: none; }
    .checksum { display: none; }

    /* Counter: hidden by default, flashes on navigation */
    .counter {
      bottom: auto;
      top: 14px;
      right: 16px;
      left: 16px;
      text-align: center;
      font-size: 13px;
      padding-top: env(safe-area-inset-top, 0px);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .counter.visible {
      opacity: 1;
    }

    /* Progress bar above safe area */
    .progress {
      bottom: env(safe-area-inset-bottom, 0px);
    }
  }

  /* ── Landscape mobile ───────────────────────────────────────── */
  @media (hover: none) and (pointer: coarse) and (orientation: landscape) {
    .controls {
      padding: 6px 16px;
      padding-bottom: calc(6px + env(safe-area-inset-bottom, 0px));
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.3));
    }

    .controls.autohidden {
      opacity: 0;
      pointer-events: none;
    }

    .counter {
      font-size: 11px;
    }
  }

  /* Print styles for PDF-like output */
  @media print {
    body { background: white; }
    .progress, .counter, .controls, .help-overlay,
    .click-prev, .click-next, .topright, .checksum,
    .menu-backdrop, .menu-sheet, .docs-overlay { display: none !important; }
    .slide {
      position: relative !important;
      display: flex !important;
      opacity: 1 !important;
      pointer-events: auto !important;
      page-break-after: always;
      height: 100vh;
    }
  }
</style>
</head>
<body>

<div class="deck" id="deck">
  <div class="slide active nearby"><img src="./assets/slides/defense-slide-1.png" alt="Slide 1" draggable="false" decoding="async"/></div>
  <div class="slide nearby"><img src="./assets/slides/defense-slide-2.png" alt="Slide 2" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-3.png" alt="Slide 3" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-4.png" alt="Slide 4" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-5.png" alt="Slide 5" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-6.png" alt="Slide 6" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-7.png" alt="Slide 7" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-8.png" alt="Slide 8" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-9.png" alt="Slide 9" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-10.png" alt="Slide 10" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-11.png" alt="Slide 11" draggable="false" decoding="async" loading="lazy"/></div>
  <div class="slide"><img src="./assets/slides/defense-slide-12.png" alt="Slide 12" draggable="false" decoding="async" loading="lazy"/></div>
</div>

<div class="progress" id="progress"></div>
<div class="counter" id="counter">1 / 12</div>

<div class="controls" id="controls">
  <button class="desktop-only" onclick="goTo(0)">First</button>
  <button onclick="prev()">Prev</button>
  <button onclick="next()">Next</button>
  <button class="desktop-only" onclick="goTo(totalSlides - 1)">Last</button>
  <button class="desktop-only" onclick="toggleFullscreen()">Fullscreen</button>
  <button class="desktop-only" onclick="toggleDocs()">Docs</button>
  <button class="desktop-only" onclick="toggleHelp()">?</button>
  <button class="menu-btn" onclick="toggleMenu()" aria-label="More options">&#x22EF;</button>
</div>

<div class="topright">
  <a class="dl" href="https://github.com/LoggieLabs/loggie-defense-deck/releases/download/defense-deck-v1/loggie-defense-pitch-deck.pdf" target="_blank" rel="noopener">Open PDF</a>
  <a class="dl" href="https://github.com/LoggieLabs/loggie-defense-deck/releases/download/defense-deck-v1/loggie-defense-pitch-deck.pdf" download>Download PDF</a>
  <button class="dl btn" onclick="toggleDocs()">Docs</button>
  <button class="dl btn" id="verifyShaBtn" type="button" title="Verify the PDF integrity against its published SHA-256 checksum. If opened locally, you will be prompted to select your copy of the PDF — the file never leaves your browser.">Verify (SHA-256)</button>
  <span class="sha-status" id="shaStatus" aria-live="polite"></span>
</div>

<div class="checksum">Deck PDF SHA-256: d8c978f30b3bb07d184674b361d99648ae0a6976f443ec0e5b110325ecea53c5</div>

<div class="click-prev" onclick="prev()"></div>
<div class="click-next" onclick="next()"></div>

<!-- Mobile bottom-sheet menu -->
<div class="menu-backdrop" id="menuBackdrop" onclick="closeMenu()"></div>
<div class="menu-sheet" id="menuSheet">
  <div class="menu-handle"></div>
  <a href="https://github.com/LoggieLabs/loggie-defense-deck/releases/download/defense-deck-v1/loggie-defense-pitch-deck.pdf" target="_blank" rel="noopener" onclick="closeMenu()">Open PDF</a>
  <a href="https://github.com/LoggieLabs/loggie-defense-deck/releases/download/defense-deck-v1/loggie-defense-pitch-deck.pdf" download onclick="closeMenu()">Download PDF</a>
  <button onclick="triggerVerify()">Verify (SHA-256)</button>
  <button onclick="toggleHelp(); closeMenu();">Help</button>
  <button onclick="toggleFullscreen(); closeMenu();">Fullscreen</button>
  <button onclick="goTo(0); closeMenu();">First Slide</button>
  <button onclick="goTo(totalSlides-1); closeMenu();">Last Slide</button>
  <div style="height:1px;background:rgba(255,255,255,0.1);margin:6px 0;"></div>
  <a href="./assets/docs/loggie-defense-capability-brief-exec.pdf" target="_blank" rel="noopener" onclick="closeMenu()">Capability Brief (Exec)</a>
  <a href="./assets/docs/loggie-defense-capability-brief.pdf" target="_blank" rel="noopener" onclick="closeMenu()">Capability Brief (Full)</a>
  <a href="./assets/docs/loggie_cmmc_pilot_sow.pdf" target="_blank" rel="noopener" onclick="closeMenu()">CMMC Pilot SOW</a>
  <a href="./assets/docs/loggie_security_faq.pdf" target="_blank" rel="noopener" onclick="closeMenu()">Security FAQ</a>
  <a href="./assets/docs/loggie_architecture_diagram.pdf" target="_blank" rel="noopener" onclick="closeMenu()">Architecture Diagram</a>
  <a href="./assets/docs/loggie_defense_relevance.pdf" target="_blank" rel="noopener" onclick="closeMenu()">Defense Relevance</a>
</div>

<div class="docs-overlay" id="docsOverlay" onclick="if(event.target===this)toggleDocs()">
  <div class="docs-content">
    <div class="title">Documents</div>
    <a href="./assets/docs/loggie-defense-capability-brief-exec.pdf" target="_blank" rel="noopener">Capability Brief (Exec)</a>
    <a href="./assets/docs/loggie-defense-capability-brief.pdf" target="_blank" rel="noopener">Capability Brief (Full)</a>
    <a href="./assets/docs/loggie_cmmc_pilot_sow.pdf" target="_blank" rel="noopener">CMMC Pilot SOW</a>
    <a href="./assets/docs/loggie_security_faq.pdf" target="_blank" rel="noopener">Security FAQ</a>
    <a href="./assets/docs/loggie_architecture_diagram.pdf" target="_blank" rel="noopener">Architecture Diagram</a>
    <a href="./assets/docs/loggie_defense_relevance.pdf" target="_blank" rel="noopener">Defense Relevance</a>
  </div>
</div>

<div class="help-overlay" id="helpOverlay">
  <div class="help-content">
    <div class="title">Navigation</div>
    <kbd>&rarr;</kbd> <kbd>Space</kbd> <kbd>&darr;</kbd> Next slide<br/>
    <kbd>&larr;</kbd> <kbd>Backspace</kbd> <kbd>&uarr;</kbd> Previous slide<br/>
    <kbd>Home</kbd> First slide<br/>
    <kbd>End</kbd> Last slide<br/>
    <kbd>F</kbd> Toggle fullscreen<br/>
    <kbd>Esc</kbd> Exit fullscreen / close help<br/>
    <kbd>?</kbd> Toggle this help<br/><br/>
    Swipe or tap left / right to navigate.
  </div>
</div>

<script>
  // ─── Mobile detection ───────────────────────────────────────────────
  const isMobile = matchMedia('(hover: none) and (pointer: coarse)').matches;

  // ─── Core slide engine ──────────────────────────────────────────────
  const slides = document.querySelectorAll('.slide');
  const totalSlides = slides.length;
  const progress = document.getElementById('progress');
  const counter = document.getElementById('counter');
  const helpOverlay = document.getElementById('helpOverlay');
  const controlsEl = document.getElementById('controls');
  let current = 0;

  /* Keep only current ± 1 slides in the render tree */
  function updateNearby(idx) {
    for (let i = 0; i < totalSlides; i++) {
      if (i >= idx - 1 && i <= idx + 1) {
        slides[i].classList.add('nearby');
      } else {
        slides[i].classList.remove('nearby');
      }
    }
  }

  /* Pre-warm adjacent images in browser cache */
  function preloadAdjacent(idx) {
    [idx - 1, idx + 1].forEach(function (i) {
      if (i >= 0 && i < totalSlides) {
        var src = slides[i].querySelector('img').getAttribute('src');
        if (src) new Image().src = src;
      }
    });
  }

  function goTo(n) {
    if (n < 0 || n >= totalSlides || n === current) return;
    slides[current].classList.remove('active');
    current = n;
    slides[current].classList.add('active');
    updateNearby(current);
    preloadAdjacent(current);
    progress.style.width = ((current + 1) / totalSlides * 100) + '%';
    counter.textContent = (current + 1) + ' / ' + totalSlides;
    if (isMobile) flashCounter();
  }

  function next() { goTo(current + 1); }
  function prev() { goTo(current - 1); }

  // Initialize
  updateNearby(0);
  progress.style.width = (1 / totalSlides * 100) + '%';

  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(function () {});
    } else {
      document.exitFullscreen();
    }
  }

  function toggleHelp() {
    helpOverlay.classList.toggle('visible');
  }

  // ─── Docs overlay ────────────────────────────────────────────────────
  var docsOverlay = document.getElementById('docsOverlay');

  function toggleDocs() {
    docsOverlay.classList.toggle('visible');
  }

  // ─── Keyboard ───────────────────────────────────────────────────────
  document.addEventListener('keydown', function (e) {
    // Close overlays on Escape
    if (docsOverlay.classList.contains('visible') && e.key === 'Escape') {
      docsOverlay.classList.remove('visible');
      return;
    }
    if (helpOverlay.classList.contains('visible') && e.key !== '?') {
      helpOverlay.classList.remove('visible');
      if (e.key === 'Escape') return;
    }
    // Don't navigate while an overlay is open
    if (docsOverlay.classList.contains('visible')) return;

    switch (e.key) {
      case 'ArrowRight':
      case 'ArrowDown':
      case ' ':
      case 'PageDown':
        e.preventDefault();
        next();
        break;
      case 'ArrowLeft':
      case 'ArrowUp':
      case 'Backspace':
      case 'PageUp':
        e.preventDefault();
        prev();
        break;
      case 'Home':
        e.preventDefault();
        goTo(0);
        break;
      case 'End':
        e.preventDefault();
        goTo(totalSlides - 1);
        break;
      case 'f':
      case 'F':
        toggleFullscreen();
        break;
      case 'd':
      case 'D':
        toggleDocs();
        break;
      case '?':
        toggleHelp();
        break;
      case 'Escape':
        if (helpOverlay.classList.contains('visible')) {
          helpOverlay.classList.remove('visible');
        }
        break;
    }
  });

  // ─── Touch / swipe ─────────────────────────────────────────────────
  var touchStartX = 0;
  var touchStartY = 0;

  document.addEventListener('touchstart', function (e) {
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
  }, { passive: true });

  document.addEventListener('touchend', function (e) {
    var dx = e.changedTouches[0].screenX - touchStartX;
    var dy = e.changedTouches[0].screenY - touchStartY;
    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
      if (dx < 0) next();
      else prev();
    }
  }, { passive: true });

  // ─── Mobile counter flash ──────────────────────────────────────────
  var counterTimer = null;
  function flashCounter() {
    counter.classList.add('visible');
    clearTimeout(counterTimer);
    counterTimer = setTimeout(function () { counter.classList.remove('visible'); }, 1500);
  }

  // ─── Mobile ⋯ menu ────────────────────────────────────────────────
  var menuBackdrop = document.getElementById('menuBackdrop');
  var menuSheet = document.getElementById('menuSheet');

  function toggleMenu() {
    var open = menuSheet.classList.toggle('open');
    menuBackdrop.classList.toggle('open', open);
  }

  function closeMenu() {
    menuSheet.classList.remove('open');
    menuBackdrop.classList.remove('open');
  }

  function triggerVerify() {
    closeMenu();
    document.getElementById('verifyShaBtn').click();
  }

  // ─── Landscape auto-hide controls ─────────────────────────────────
  if (isMobile) {
    var hideTimer = null;
    var landscapeMQ = matchMedia('(orientation: landscape)');

    function resetAutoHide() {
      controlsEl.classList.remove('autohidden');
      clearTimeout(hideTimer);
      if (landscapeMQ.matches) {
        hideTimer = setTimeout(function () { controlsEl.classList.add('autohidden'); }, 2000);
      }
    }

    landscapeMQ.addEventListener('change', resetAutoHide);
    document.addEventListener('touchstart', resetAutoHide, { passive: true });
    resetAutoHide();

    // Show counter briefly on load
    flashCounter();
  }

  // ─── SHA-256 verification ──────────────────────────────────────────
  var PDF_PATH = "https://github.com/LoggieLabs/loggie-defense-deck/releases/download/defense-deck-v1/loggie-defense-pitch-deck.pdf";
  var EXPECTED_SHA256 = "d8c978f30b3bb07d184674b361d99648ae0a6976f443ec0e5b110325ecea53c5";

  var verifyBtn = document.getElementById("verifyShaBtn");
  var shaStatus = document.getElementById("shaStatus");
  var fadeTimer = null;

  // Hidden file input for local verification fallback
  var fileInput = document.createElement("input");
  fileInput.type = "file";
  fileInput.accept = ".pdf";
  fileInput.style.display = "none";
  document.body.appendChild(fileInput);

  function setStatus(text, cls) {
    shaStatus.textContent = text;
    shaStatus.className = "sha-status " + (cls || "warn");
    shaStatus.style.opacity = "1";
    clearTimeout(fadeTimer);
    fadeTimer = setTimeout(function () {
      shaStatus.style.opacity = "0";
      setTimeout(function () {
        shaStatus.textContent = "";
        shaStatus.className = "sha-status";
        shaStatus.style.opacity = "";
      }, 400);
    }, 7000);
  }

  function hexEncode(buffer) {
    var bytes = new Uint8Array(buffer);
    var out = "";
    for (var i = 0; i < bytes.length; i++) {
      out += bytes[i].toString(16).padStart(2, "0");
    }
    return out;
  }

  async function hashAndCompare(buf) {
    var digest = await crypto.subtle.digest("SHA-256", buf);
    var got = hexEncode(digest);
    if (got === EXPECTED_SHA256) {
      setStatus("Verified", "ok");
    } else {
      setStatus("Mismatch", "bad");
    }
  }

  // Try fetch first (works when served via HTTP), fall back to file picker
  verifyBtn.addEventListener("click", async function () {
    try {
      setStatus("Verifying\u2026", "warn");
      var res = await fetch(PDF_PATH, { cache: "no-store" });
      if (!res.ok) throw new Error("fetch_failed");
      var buf = await res.arrayBuffer();
      await hashAndCompare(buf);
    } catch (e) {
      // Fetch blocked (file:// or CORS) — fall back to file picker
      setStatus("Select PDF\u2026", "warn");
      fileInput.click();
    }
  });

  fileInput.addEventListener("change", async function () {
    var file = fileInput.files[0];
    if (!file) return;
    try {
      setStatus("Verifying\u2026", "warn");
      var buf = await file.arrayBuffer();
      await hashAndCompare(buf);
    } catch (e) {
      setStatus("Error", "bad");
    }
    fileInput.value = "";
  });
</script>

</body>
</html>
